<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="â€œæä¸–è¶…çš„åšå®¢, ç¨‹åºå‘˜, å¼€å‘è€…, iOSå¼€å‘è€…â€" />





  <link rel="alternate" href="/atom.xml" title="Amin_iOSÂ·Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/uploads/favicon.ico?v=5.0.1" />






<meta name="description" content="å—¨ï¼Œæˆ‘æ˜¯æä¸–è¶… (@Amin_iOS)ï¼Œä¸€åç§»åŠ¨ç«¯çš„Development And Managementï¼Œç°å±…å¹¿å·ã€‚æ­£åœ¨ä¿®è¡Œï¼Œæ¢æ±‚åˆ›æ„ä¹‹æºï¼Œè®°å½•è‡ªå·±å­¦ä¹ çš„ç‚¹æ»´ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="Amin_iOSÂ·Blog">
<meta property="og:url" content="http://lishichao.github.io/index.html">
<meta property="og:site_name" content="Amin_iOSÂ·Blog">
<meta property="og:description" content="å—¨ï¼Œæˆ‘æ˜¯æä¸–è¶… (@Amin_iOS)ï¼Œä¸€åç§»åŠ¨ç«¯çš„Development And Managementï¼Œç°å±…å¹¿å·ã€‚æ­£åœ¨ä¿®è¡Œï¼Œæ¢æ±‚åˆ›æ„ä¹‹æºï¼Œè®°å½•è‡ªå·±å­¦ä¹ çš„ç‚¹æ»´ã€‚">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Amin_iOSÂ·Blog">
<meta name="twitter:description" content="å—¨ï¼Œæˆ‘æ˜¯æä¸–è¶… (@Amin_iOS)ï¼Œä¸€åç§»åŠ¨ç«¯çš„Development And Managementï¼Œç°å±…å¹¿å·ã€‚æ­£åœ¨ä¿®è¡Œï¼Œæ¢æ±‚åˆ›æ„ä¹‹æºï¼Œè®°å½•è‡ªå·±å­¦ä¹ çš„ç‚¹æ»´ã€‚">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'åšä¸»'
    }
  };
</script>

  <title> Amin_iOSÂ·Blog - å—¨ï¼Œæˆ‘æ˜¯æä¸–è¶… (@Amin_iOS)ï¼Œä¸€åç§»åŠ¨ç«¯çš„Development And Managementï¼Œç°å±…å¹¿å·ã€‚æ­£åœ¨ä¿®è¡Œï¼Œæ¢æ±‚åˆ›æ„ä¹‹æºï¼Œè®°å½•è‡ªå·±å­¦ä¹ çš„ç‚¹æ»´ã€‚ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Amin_iOSÂ·Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">ä»è¿™é‡Œï¼Œå¼€å¯æ¢¦æƒ³ä¹‹é—¨ï¼</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>
<nav class="site-nav">
  

  
    <ul id="menu" class="menu">

      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-commenting fa-fw"></i> <br />
            
            ç•™è¨€
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat fa-fw"></i> <br />
            
            å…¬ç›Š404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'SpFc6UCUJ1z1Hz2YFnz7','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/30/iOSåº”ç”¨æ”¯æŒIPV6ï¼Œå°±é‚£ç‚¹äº‹å„¿/" itemprop="url">
                  iOSåº”ç”¨æ”¯æŒIPV6ï¼Œå°±é‚£ç‚¹äº‹å„¿
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="fa fa-calendar-o" style="margin:2px"></span>
            <time itemprop="dateCreated" datetime="2016-05-30T21:13:10+08:00" content="2016-05-30">
              2016-05-30
            </time>
          </span>
	
	<span class="post-count">&nbsp; |&nbsp; å­—æ•° 6,208
	</span>

	<span class="post-count">&nbsp; |&nbsp; é˜…è¯»é¢„è®¡ 32åˆ†é’Ÿ</span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="fa fa-folder-o" style="margin:2px"></span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOSæŠ€æœ¯å½’çº³/" itemprop="url" rel="index">
                    <span itemprop="name">iOSæŠ€æœ¯å½’çº³</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/30/iOSåº”ç”¨æ”¯æŒIPV6ï¼Œå°±é‚£ç‚¹äº‹å„¿/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/30/iOSåº”ç”¨æ”¯æŒIPV6ï¼Œå°±é‚£ç‚¹äº‹å„¿/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/05/30/iOSåº”ç”¨æ”¯æŒIPV6ï¼Œå°±é‚£ç‚¹äº‹å„¿/" class="leancloud_visitors" data-flag-title="iOSåº”ç”¨æ”¯æŒIPV6ï¼Œå°±é‚£ç‚¹äº‹å„¿">
               &nbsp; | &nbsp;
               <span class="fa fa-eye" style="margin:2px"></span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>æœç„¶æ˜¯è‹¹æœæ‰“ä¸ªå“ˆæ¬ ï¼ŒiOSè¡Œä¸šå†…å°±å¾—èµ·ä¸€æ¬¡é£æš´å‘€ã€‚è‡ªä»5æœˆåˆAppleæ˜æ–‡è§„å®šæ‰€æœ‰å¼€å‘è€…åœ¨6æœˆ1å·ä»¥åæäº¤æ–°ç‰ˆæœ¬éœ€è¦æ”¯æŒIPV6-Onlyçš„ç½‘ç»œï¼Œå¤§å®¶ä¾¿å¼€å§‹çƒ­ç«æœå¤©çš„ç ”ç©¶å¦‚ä½•æ”¯æŒIPV6ï¼Œä»¥åŠåº”ç”¨ä¸­å“ªäº›æ¨¡å—ç›®å‰ä¸æ”¯æŒIPV6ã€‚</p>
</blockquote>
<h4 id="ä¸€ã€IPV6-Onlyæ”¯æŒæ˜¯å•¥ï¼Ÿ"><a href="#ä¸€ã€IPV6-Onlyæ”¯æŒæ˜¯å•¥ï¼Ÿ" class="headerlink" title="ä¸€ã€IPV6-Onlyæ”¯æŒæ˜¯å•¥ï¼Ÿ"></a>ä¸€ã€IPV6-Onlyæ”¯æŒæ˜¯å•¥ï¼Ÿ</h4><p>é¦–å…ˆIPV6ï¼Œæ˜¯å¯¹IPV4åœ°å€ç©ºé—´çš„æ‰©å……ã€‚ç›®å‰å½“æˆ‘ä»¬ç”¨iOSè®¾å¤‡è¿æ¥ä¸ŠWifiã€4Gã€3Gç­‰ç½‘ç»œæ—¶ï¼Œè®¾å¤‡è¢«åˆ†é…çš„åœ°å€å‡æ˜¯IPV4åœ°å€ï¼Œä½†æ˜¯éšç€è¿è¥å•†å’Œä¼ä¸šé€æ¸éƒ¨ç½²IPV6 DNS64/NAT64ç½‘ç»œä¹‹åï¼Œè®¾å¤‡è¢«åˆ†é…çš„åœ°å€ä¼šå˜æˆIPV6çš„åœ°å€ï¼Œè€Œè¿™äº›ç½‘ç»œå°±æ˜¯æ‰€è°“çš„IPV6-Onlyç½‘ç»œï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥é€šè¿‡æ­¤ç½‘ç»œå»è·å–IPV4åœ°å€æä¾›çš„å†…å®¹ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯è¯·æ±‚åŸŸåè§£æï¼Œé¦–å…ˆé€šè¿‡DNS64 ServeræŸ¥è¯¢IPv6çš„åœ°å€ï¼Œå¦‚æœæŸ¥è¯¢ä¸åˆ°ï¼Œå†å‘DNS ServeræŸ¥è¯¢IPv4åœ°å€ï¼Œé€šè¿‡DNS64 Serveråˆæˆä¸€ä¸ªIPV6çš„åœ°å€ï¼Œæœ€ç»ˆå°†ä¸€ä¸ªIPV6çš„åœ°å€è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://7xstl7.com1.z0.glb.clouddn.com/%E6%8A%80%E6%9C%AF/ipv6_1.png" alt=""></p>
<p>åœ¨Mac OS 10.11ï¼‹çš„åŒç½‘å¡çš„Macæœºå™¨ï¼ˆä»¥å¤ªç½‘å£ï¼‹æ— çº¿ç½‘å¡ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨¡æ‹Ÿæ„å»ºè¿™ä¹ˆä¸€ä¸ªlocal IPv6 DNS64/NAT64 çš„ç½‘ç»œç¯å¢ƒå»æµ‹è¯•åº”ç”¨æ˜¯å¦æ”¯æŒIPV6-Onlyç½‘ç»œï¼Œå¤§æ¦‚åŸç†å¦‚ä¸‹ï¼š</p>
<p><img src="http://7xstl7.com1.z0.glb.clouddn.com/%E6%8A%80%E6%9C%AF/ipv6_2.png" alt=""></p>
<ul>
<li>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://developer.apple.com/library/mac/documentation/NetworkingInternetWeb/Conceptual/NetworkingOverview/UnderstandingandPreparingfortheIPv6Transition/UnderstandingandPreparingfortheIPv6Transition.html#//apple_ref/doc/uid/TP40010220-CH213-SW1" target="_blank" rel="external">https://developer.apple.com/library/mac/documentation/NetworkingInternetWeb/Conceptual/NetworkingOverview/UnderstandingandPreparingfortheIPv6Transition/UnderstandingandPreparingfortheIPv6Transition.html#//apple_ref/doc/uid/TP40010220-CH213-SW1</a></li>
</ul>
<h4 id="äºŒã€Appleå¦‚ä½•å®¡æ ¸æ”¯æŒIPV6-Onlyï¼Ÿ"><a href="#äºŒã€Appleå¦‚ä½•å®¡æ ¸æ”¯æŒIPV6-Onlyï¼Ÿ" class="headerlink" title="äºŒã€Appleå¦‚ä½•å®¡æ ¸æ”¯æŒIPV6-Onlyï¼Ÿ"></a>äºŒã€Appleå¦‚ä½•å®¡æ ¸æ”¯æŒIPV6-Onlyï¼Ÿ</h4><p><strong><em>é¦–å…ˆç¬¬ä¸€ç‚¹</em></strong>ï¼šè¿™é‡Œè¯´çš„æ”¯æŒIPV6-Onlyç½‘ç»œï¼Œå…¶å®å°±æ˜¯è¯´è®©åº”ç”¨åœ¨ IPv6 DNS64/NAT64 ç½‘ç»œç¯å¢ƒä¸‹ä»ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯è€ƒè™‘åˆ°æˆ‘ä»¬ç›®å‰çš„å®é™…ç½‘ç»œç¯å¢ƒä»ç„¶æ˜¯IPV4ç½‘ç»œï¼Œæ‰€ä»¥åº”ç”¨éœ€è¦èƒ½å¤ŸåŒæ—¶ä¿è¯IPV4å’ŒIPV6ç¯å¢ƒä¸‹çš„å¯ç”¨æ€§ã€‚ä»è¿™ç‚¹æ¥è¯´ï¼Œè‹¹æœä¸ä¼šå»æ‰«æIPV4çš„ä¸“æœ‰APIæ¥æ‹’ç»å®¡æ ¸é€šè¿‡ï¼Œå› ä¸ºIPV4çš„APIå’ŒIPV6çš„APIè°ƒç”¨éƒ½ä¼šåŒæ—¶å­˜åœ¨äºä»£ç ä¸­ï¼ˆ<strong><em>ä¸è¿‡ä¸ºäº†å‡å°å®¡æ ¸è¢«æ‹’é£é™©ï¼Œå»ºè®®å°†IPV4ä¸“æœ‰APIé€šè¿‡IPV6çš„å…¼å®¹APIæ¥æ›¿æ¢</em></strong>ï¼‰ã€‚</p>
<p><strong><em>å…¶æ¬¡ç¬¬äºŒç‚¹</em></strong>ï¼šAppleå®˜æ–¹å£°æ˜iOS9å¼€å§‹å‘IPV6æ”¯æŒè¿‡æ¸¡ï¼Œåœ¨iOS9.2+æ”¯æŒé€šè¿‡getaddrInfoæ–¹æ³•å°†IPV4åœ°å€åˆæˆIPV6åœ°å€ï¼ˆ<strong><em>The ability to synthesize IPv6 addresses was added to getaddrinfo in iOS 9.2 and OS X 10.11.2</em></strong>ï¼‰ã€‚å…¶æä¾›çš„Reachabilityåº“åœ¨iOS8ç³»ç»Ÿä¸‹ï¼Œå½“ä»IPV4åˆ‡æ¢åˆ°IPV6ç½‘ç»œï¼Œæˆ–è€…ä»IPV6ç½‘ç»œåˆ‡æ¢åˆ°IPV4ï¼Œæ˜¯æ— æ³•ç›‘æ§åˆ°ç½‘ç»œçŠ¶æ€çš„å˜åŒ–ã€‚ä¹Ÿæœ‰ä¸€äº›å¼€å‘è€…é’ˆå¯¹è¿™äº›Bugè¯¢é—®Appleçš„å®¡æ ¸éƒ¨é—¨ï¼Œ<strong><em>ç»™äºˆçš„ç­”å¤æ˜¯åªéœ€è¦åœ¨è‹¹æœæœ€æ–°çš„ç³»ç»Ÿä¸Šä¿è¯IPV6çš„å…¼å®¹æ€§å³å¯</em></strong>ã€‚</p>
<p><strong><em>æœ€åç¬¬ä¸‰ç‚¹</em></strong>ï¼šåªè¦åº”ç”¨çš„ä¸»æµç¨‹æ”¯æŒIPV6ï¼Œé€šè¿‡è‹¹æœå®¡æ ¸å³å¯ã€‚å¯¹äºä¸æ”¯æŒIPV6çš„æ¨¡å—ï¼Œè€ƒè™‘åˆ°æˆ‘ä»¬ç°å®IPV6ç½‘ç»œçš„éƒ¨ç½²è¿˜éœ€è¦ä¸€æ®µæ—¶é—´ï¼ŒçŸ­æ—¶é—´å†…ä¸ä¼šå½±å“æˆ‘ä»¬ç”¨æˆ·çš„ä½¿ç”¨ã€‚ä½†éšç€4Gç½‘ç»œIPV6çš„éƒ¨ç½²ï¼Œè¿™éƒ¨åˆ†æ¨¡å—è¿˜æ˜¯éœ€è¦é€æ¸å®‰æ’äººåŠ›è¿›è¡Œæ”¯æŒã€‚</p>
<p><strong><em>è¿½åŠ ç¬¬å››ç‚¹</em></strong>ï¼šå¦‚æœåº”ç”¨ä¸€ç›´ç›´æ¥ä½¿ç”¨IPV4åœ°å€é€šè¿‡NSURLConenctionæˆ–è€…NSURLSessionè¿›è¡Œç½‘ç»œè¯·æ±‚(ä¸€èˆ¬éœ€è¦æœåŠ¡å™¨å…è®¸ï¼Œä¸”å®¢æˆ·ç«¯éœ€è¦åœ¨headerä¸­ä¼ªè£…host)ï¼›ç»æµ‹è¯•ï¼ŒIPV6ç½‘ç»œç¯å¢ƒä¸‹ï¼Œç›´æ¥ä½¿ç”¨IPV4åœ°å€åœ¨iOS9åŠä»¥ä¸Šçš„ç³»ç»Ÿä»ç„¶èƒ½å¤Ÿæ­£å¸¸è®¿é—®ï¼›åœ¨iOS8.4åŠä»¥ä¸‹ä¸èƒ½æ­£å¸¸è®¿é—®ï¼›è¿™ä¸€ç‚¹è‹¹æœçš„è§£é‡Šå’Œå»ºè®®æ˜¯è¿™æ ·çš„ï¼š</p>
<hr>
<p>Note: In iOS 9 and OS X 10.11 and later, NSURLSession and CFNetwork automatically synthesize IPv6 addresses from IPv4 literals locally on devices operating on DNS64/NAT64 networks. However, you should still work to rid your code of IP address literals.</p>
<hr>
<h4 id="ä¸‰ã€åº”ç”¨å¦‚ä½•æ”¯æŒIPV6-Onlyï¼Ÿ"><a href="#ä¸‰ã€åº”ç”¨å¦‚ä½•æ”¯æŒIPV6-Onlyï¼Ÿ" class="headerlink" title="ä¸‰ã€åº”ç”¨å¦‚ä½•æ”¯æŒIPV6-Onlyï¼Ÿ"></a>ä¸‰ã€åº”ç”¨å¦‚ä½•æ”¯æŒIPV6-Onlyï¼Ÿ</h4><p>å¯¹äºå¦‚ä½•æ”¯æŒIPV6-Onlyï¼Œå®˜æ–¹ç»™å‡ºäº†å¦‚ä¸‹å‡ ç‚¹æ ‡å‡†ï¼šï¼ˆè¿™é‡Œå°±ä¸å¯¹å…¶è¿›è¡Œè§£é‡Šäº†ï¼Œå¤§å®¶çœ‹ä¸Šé¢çš„å‚è€ƒé“¾æ¥å³å¯ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> Use High-Level Networking Frameworks;</span><br><span class="line"><span class="number">2.</span> Donâ€™t Use IP Address Literals;</span><br><span class="line"><span class="number">3.</span> Check Source Code <span class="keyword">for</span> IPv6 DNS64/NAT64 Incompatibilities;</span><br><span class="line"><span class="number">4.</span> Use System APIs to Synthesize IPv6 Addresses;</span><br></pre></td></tr></table></figure>
<h4 id="3-1-NSURLConnectionæ˜¯å¦æ”¯æŒIPV6ï¼Ÿ"><a href="#3-1-NSURLConnectionæ˜¯å¦æ”¯æŒIPV6ï¼Ÿ" class="headerlink" title="3.1 NSURLConnectionæ˜¯å¦æ”¯æŒIPV6ï¼Ÿ"></a>3.1 NSURLConnectionæ˜¯å¦æ”¯æŒIPV6ï¼Ÿ</h4><p>å®˜æ–¹çš„è¿™å¥è¯è®©æˆ‘ä»¬ç–‘æƒ‘é¡¿ç”Ÿï¼š<br><strong><em>using high-level networking APIs such as NSURLSession and the CFNetwork frameworks and you connect by name, you should not need to change anything for your app to work with IPv6 addresses</em></strong></p>
<p>åªè¯´äº†NSURLSessionå’ŒCFNetworkçš„APIä¸éœ€è¦æ”¹å˜ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æåŠåˆ°NSURLConnectionã€‚ ä»ä¸Šæ–‡çš„å‚è€ƒèµ„æ–™ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°NSURLSessionã€NSURLConnectionåŒå±äºCocoaçš„url loading systemï¼Œå¯ä»¥çŒœæµ‹å‡ºNSURLConnectionåœ¨ios9ä¸Šæ˜¯æ”¯æŒIPV6çš„ã€‚</p>
<p>åº”ç”¨é‡Œé¢çš„APIç½‘ç»œè¯·æ±‚ï¼Œå¤§å®¶ä¸€èˆ¬éƒ½ä¼šé€‰æ‹©AFNetworkingè¿›è¡Œè¯·æ±‚å‘é€ï¼Œç”±äºå†å²åŸå› ï¼Œåº”ç”¨çš„ä»£ç åŸºæœ¬ä¸Šéƒ½æ·±åº¦å¼•ç”¨äº†AFHTTPRequestOperationç±»ï¼Œæ‰€ä»¥ç›®å‰APIç½‘ç»œè¯·æ±‚å‡éœ€è¦é€šè¿‡NSURLConnectionå‘é€å‡ºå»ï¼Œæ‰€ä»¥å¿…é¡»ç¡®è®¤NSURLConnectionæ˜¯å¦æ”¯æŒIPV6. ç»è¿‡æµ‹è¯•ï¼ŒNSURLConnectionåœ¨æœ€æ–°çš„iOS9ç³»ç»Ÿä¸Šæ˜¯æ”¯æŒIPV6çš„ã€‚</p>
<h4 id="3-2-Cocoaçš„URL-Loading-Systemä»iOSå“ªä¸ªç‰ˆæœ¬å¼€å§‹æ”¯æŒIPV6ï¼Ÿ"><a href="#3-2-Cocoaçš„URL-Loading-Systemä»iOSå“ªä¸ªç‰ˆæœ¬å¼€å§‹æ”¯æŒIPV6ï¼Ÿ" class="headerlink" title="3.2 Cocoaçš„URL Loading Systemä»iOSå“ªä¸ªç‰ˆæœ¬å¼€å§‹æ”¯æŒIPV6ï¼Ÿ"></a>3.2 Cocoaçš„URL Loading Systemä»iOSå“ªä¸ªç‰ˆæœ¬å¼€å§‹æ”¯æŒIPV6ï¼Ÿ</h4><p>ç›®å‰æˆ‘ä»¬çš„åº”ç”¨æœ€ä½ç‰ˆæœ¬è¿˜éœ€è¦æ”¯æŒiOS7ï¼Œè™½ç„¶è‹¹æœåªè¦æ±‚æœ€æ–°ç‰ˆæœ¬æ”¯æŒIPV6ï¼Onlyï¼Œä½†æ˜¯å‡ºäºå¯¹ç”¨æˆ·è´Ÿè´£çš„æ€åº¦ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ææ¸…æ¥šåœ¨ä½ç‰ˆæœ¬ä¸ŠURL Loading Systemçš„APIæ˜¯å¦æ”¯æŒIPV6.</p>
<p>ï¼ˆto fix me, make some experimentsï¼‰å¾…ç»­ï½ï½ï½</p>
<h4 id="3-3-Reachabilityæ˜¯å¦éœ€è¦ä¿®æ”¹æ”¯æŒIPV6ï¼Ÿ"><a href="#3-3-Reachabilityæ˜¯å¦éœ€è¦ä¿®æ”¹æ”¯æŒIPV6ï¼Ÿ" class="headerlink" title="3.3 Reachabilityæ˜¯å¦éœ€è¦ä¿®æ”¹æ”¯æŒIPV6ï¼Ÿ"></a>3.3 Reachabilityæ˜¯å¦éœ€è¦ä¿®æ”¹æ”¯æŒIPV6ï¼Ÿ</h4><p>æˆ‘ä»¬å¯ä»¥æŸ¥åˆ°åº”ç”¨ä¸­å¤§é‡ä½¿ç”¨äº†Reachabilityè¿›è¡Œç½‘ç»œçŠ¶æ€åˆ¤æ–­ï¼Œä½†æ˜¯åœ¨é‡Œé¢å´ä½¿ç”¨äº†IPV4çš„ä¸“ç”¨APIã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åœ¨Pods:Reachabilityä¸­</span><br><span class="line">AF_INET                  Files:Reachability.m</span><br><span class="line">struct sockaddr_in       Files:Reachability.h , Reachability.m</span><br></pre></td></tr></table></figure>
<p>é‚£Reachabilityåº”è¯¥å¦‚ä½•æ”¯æŒIPV6å‘¢ï¼Ÿ<br>ï¼ˆ1ï¼‰ç›®å‰Githubçš„å¼€æºåº“Reachabilityçš„æœ€æ–°ç‰ˆæœ¬æ˜¯3.2ï¼Œè‹¹æœä¹Ÿå‡ºäº†ä¸€ä¸ªSupport IPV6 çš„Reachabilityçš„å®˜æ–¹æ ·ä¾‹ï¼Œæˆ‘ä»¬æ¯”è¾ƒäº†ä¸€ä¸‹æºç ï¼Œè·ŸGithubä¸Šçš„Reachabilityæ²¡æœ‰ä»€ä¹ˆå·®å¼‚ã€‚<br>ï¼ˆ2ï¼‰æˆ‘ä»¬é€šå¸¸éƒ½æ˜¯é€šè¿‡ä¸€ä¸ª0.0.0.0 (ZeroAddress)å»å¼€å¯ç½‘ç»œçŠ¶æ€ç›‘æ§ï¼Œç»è¿‡æˆ‘ä»¬æµ‹è¯•ï¼Œåœ¨iOS9ä»¥ä¸Šçš„ç³»ç»Ÿä¸ŠIPV4å’ŒIPV6ç½‘ç»œç¯å¢ƒå‡èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ï¼›ä½†æ˜¯åœ¨iOS8ä¸ŠIPV4å’ŒIPV6ç›¸äº’åˆ‡æ¢çš„æ—¶å€™æ— æ³•ç›‘æ§åˆ°ç½‘ç»œçŠ¶æ€çš„å˜åŒ–ï¼Œå¯èƒ½æ˜¯å› ä¸ºè‹¹æœåœ¨iOS8ä¸Šè¿˜å¹¶æ²¡æœ‰å¯¹IPV6è¿›è¡Œç›¸å…³æ”¯æŒç›¸å…³ã€‚ï¼ˆä½†æ˜¯è¿™ä»ç„¶æ»¡è¶³è‹¹æœè¦æ±‚åœ¨æœ€æ–°ç³»ç»Ÿç‰ˆæœ¬ä¸Šæ”¯æŒIPV6çš„ç½‘ç»œï¼‰ã€‚<br>ï¼ˆ3ï¼‰å½“å¤§å®¶éƒ½åœ¨è¦æ±‚Reachabilityæ·»åŠ å¯¹äºIPV6çš„æ”¯æŒï¼Œå…¶å®è‹¹æœåœ¨iOS9ä»¥ä¸Šå¯¹Zero Addressè¿›è¡Œäº†ç‰¹åˆ«å¤„ç†ï¼Œ<a href="https://developer.apple.com/library/ios/samplecode/Reachability/Listings/ReadMe_md.html#//apple_ref/doc/uid/DTS40007324-ReadMe_md-DontLinkElementID_11" target="_blank" rel="external">å®˜æ–¹å‘è¨€</a>æ˜¯è¿™æ ·çš„ï¼š</p>
<hr>
<p>reachabilityForInternetConnection: This monitors the address 0.0.0.0,<br>which reachability treats as a special token that causes it to actually<br>monitor the general routing status of the device, both IPv4 and IPv6.</p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)reachabilityForInternetConnection &#123;</span><br><span class="line">    struct sockaddr_in zeroAddress;</span><br><span class="line">    bzero(&amp;zeroAddress, sizeof(zeroAddress));</span><br><span class="line">    zeroAddress.sin_len = sizeof(zeroAddress);</span><br><span class="line">    zeroAddress.sin_family = AF_INET;</span><br><span class="line">    <span class="keyword">return</span> [self reachabilityWithAddress: (const struct sockaddr *) &amp;zeroAddress];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒReachabilityä¸éœ€è¦åšä»»ä½•ä¿®æ”¹ï¼Œåœ¨iOS9ä¸Šå°±å¯ä»¥æ”¯æŒIPV6å’ŒIPV4ï¼Œä½†æ˜¯åœ¨iOS9ä»¥ä¸‹ä¼šå­˜åœ¨bugï¼Œä½†æ˜¯è‹¹æœå®¡æ ¸å¹¶ä¸å…³å¿ƒã€‚</p>
<h4 id="å››ã€åº•å±‚çš„socket-APIå¦‚ä½•åŒæ—¶æ”¯æŒIPV4å’ŒIPV6ï¼Ÿ"><a href="#å››ã€åº•å±‚çš„socket-APIå¦‚ä½•åŒæ—¶æ”¯æŒIPV4å’ŒIPV6ï¼Ÿ" class="headerlink" title="å››ã€åº•å±‚çš„socket APIå¦‚ä½•åŒæ—¶æ”¯æŒIPV4å’ŒIPV6ï¼Ÿ"></a>å››ã€åº•å±‚çš„socket APIå¦‚ä½•åŒæ—¶æ”¯æŒIPV4å’ŒIPV6ï¼Ÿ</h4><p>ç”±äºåœ¨åº”ç”¨ä¸­ä½¿ç”¨äº†ç½‘ç»œè¯Šæ–­çš„ç»„ä»¶ï¼Œå¤§é‡ä½¿ç”¨äº†åº•å±‚çš„ socket APIï¼Œæ‰€ä»¥å¯¹äºIPV6æ”¯æŒï¼Œè¿™å—æ˜¯ä¸ªé‡å¤´æˆã€‚å¦‚æœä½ çš„åº”ç”¨ä¸­ä½¿ç”¨äº†é•¿è¿æ¥ï¼Œå…¶å¿…ç„¶ä¼šä½¿ç”¨åº•å±‚socket APIï¼Œè¿™ä¸€å—ä¹Ÿæ˜¯éœ€è¦æ”¯æŒIPV6çš„ã€‚ å¯¹äºSocketå¦‚ä½•åŒæ—¶æ”¯æŒIPV4å’ŒIPV6ï¼Œå¯ä»¥å‚è€ƒè°·æ­Œçš„å¼€æºåº“<a href="https://github.com/robbiehanson/CocoaAsyncSocket.git" target="_blank" rel="external">CocoaAsyncSocket</a>.</p>
<p>ä¸‹é¢æˆ‘é’ˆå¯¹æˆ‘ä»¬çš„å¼€æº <a href="https://github.com/lishichao/LDNetDiagnoService_IOS" target="_blank" rel="external">ç½‘ç»œè¯Šæ–­ç»„ä»¶</a>, è¯´ä¸€ä¸‹æ˜¯å¦‚ä½•åŒæ—¶æ”¯æŒIPV4å’ŒIPV6çš„ã€‚<br>å¼€æºåœ°å€ï¼š<a href="https://github.com/Lede-Inc/LDNetDiagnoService_IOS.git" target="_blank" rel="external">https://github.com/Lede-Inc/LDNetDiagnoService_IOS.git</a><br>è¿™ä¸ªç½‘ç»œè¯Šæ–­ç»„ä»¶çš„ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>æœ¬åœ°ç½‘ç»œç¯å¢ƒçš„ç›‘æµ‹ï¼ˆæœ¬æœºIPï¼‹æœ¬åœ°ç½‘å…³ï¼‹æœ¬åœ°DNSï¼‹åŸŸåè§£æï¼‰ï¼›</li>
<li>é€šè¿‡TCP Connectç›‘æµ‹åˆ°åŸŸåçš„è¿é€šæ€§ï¼›</li>
<li>é€šè¿‡Ping ç›‘æµ‹åˆ°ç›®æ ‡ä¸»æœºçš„è¿é€šè€—æ—¶ï¼›</li>
<li>é€šè¿‡traceRouteç›‘æµ‹è®¾å¤‡åˆ°ç›®æ ‡ä¸»æœºä¸­é—´æ¯ä¸€ä¸ªè·¯ç”±å™¨èŠ‚ç‚¹çš„ICMPè€—æ—¶ï¼›</li>
</ul>
<h4 id="4-1-IPåœ°å€ä»äºŒè¿›åˆ¶åˆ°ç¬¦å·çš„è½¬åŒ–"><a href="#4-1-IPåœ°å€ä»äºŒè¿›åˆ¶åˆ°ç¬¦å·çš„è½¬åŒ–" class="headerlink" title="4.1 IPåœ°å€ä»äºŒè¿›åˆ¶åˆ°ç¬¦å·çš„è½¬åŒ–"></a>4.1 IPåœ°å€ä»äºŒè¿›åˆ¶åˆ°ç¬¦å·çš„è½¬åŒ–</h4><p>ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡inet_ntoa()è¿›è¡ŒäºŒè¿›åˆ¶åˆ°ç¬¦å·ï¼Œè¿™ä¸ªAPIåªèƒ½è½¬åŒ–IPV4åœ°å€ã€‚è€Œinet_ntop()èƒ½å¤Ÿå…¼å®¹è½¬åŒ–IPV4å’ŒIPV6åœ°å€ã€‚ å†™äº†ä¸€ä¸ªå…¬ç”¨çš„in6_addrçš„è½¬åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//<span class="keyword">for</span> IPV6</span><br><span class="line">+(NSString *)formatIPV6Address:(struct in6_addr)ipv6Addr&#123;</span><br><span class="line">    NSString *address = nil;</span><br><span class="line"></span><br><span class="line">    char dstStr[INET6_ADDRSTRLEN];</span><br><span class="line">    char srcStr[INET6_ADDRSTRLEN];</span><br><span class="line">    memcpy(srcStr, &amp;ipv6Addr, sizeof(struct in6_addr));</span><br><span class="line">    <span class="keyword">if</span>(inet_ntop(AF_INET6, srcStr, dstStr, INET6_ADDRSTRLEN) != NULL)&#123;</span><br><span class="line">        address = [NSString stringWithUTF8String:dstStr];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//<span class="keyword">for</span> IPV4</span><br><span class="line">+(NSString *)formatIPV4Address:(struct in_addr)ipv4Addr&#123;</span><br><span class="line">    NSString *address = nil;</span><br><span class="line"></span><br><span class="line">    char dstStr[INET_ADDRSTRLEN];</span><br><span class="line">    char srcStr[INET_ADDRSTRLEN];</span><br><span class="line">    memcpy(srcStr, &amp;ipv4Addr, sizeof(struct in_addr));</span><br><span class="line">    <span class="keyword">if</span>(inet_ntop(AF_INET, srcStr, dstStr, INET_ADDRSTRLEN) != NULL)&#123;</span><br><span class="line">        address = [NSString stringWithUTF8String:dstStr];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-2-æœ¬æœºIPè·å–æ”¯æŒIPV6"><a href="#4-2-æœ¬æœºIPè·å–æ”¯æŒIPV6" class="headerlink" title="4.2 æœ¬æœºIPè·å–æ”¯æŒIPV6"></a>4.2 æœ¬æœºIPè·å–æ”¯æŒIPV6</h4><p>ç›¸å½“äºæˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­è¾“å…¥ifconfigå‘½ä»¤è·å–å­—ç¬¦ä¸²ï¼Œç„¶åå¯¹ifconfigç»“æœå­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œè·å–å…¶ä¸­en0ï¼ˆWifiï¼‰ã€pdp_ip0ï¼ˆç§»åŠ¨ç½‘ç»œï¼‰çš„ipåœ°å€ã€‚</p>
<p>æ³¨æ„ï¼š<br>ï¼ˆ1ï¼‰åœ¨æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºä¸Šéƒ½ä¼šå‡ºç°ä»¥FE80å¼€å¤´çš„IPV6å•æ’­åœ°å€å½±å“æˆ‘ä»¬åˆ¤æ–­ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè¿›è¡Œç‰¹æ®Šçš„å¤„ç†ï¼ˆå½“ç¬¬ä¸€æ¬¡é‡åˆ°ä¸æ˜¯å•æ’­åœ°å€çš„IPåœ°å€å³ä¸ºæœ¬æœºIPåœ°å€ï¼‰ã€‚<br>ï¼ˆ2ï¼‰åœ¨IPV6ç¯å¢ƒä¸‹ï¼ŒçœŸæœºæµ‹è¯•çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå‡ºç°çš„æ˜¯ä¸€ä¸ªIPV4åœ°å€ï¼Œæ‰€ä»¥åœ¨IPV4æ¡ä»¶ä¸‹ç¬¬ä¸€æ¬¡é‡åˆ°å•æ’­åœ°å€ä¸é€€å‡ºã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+ (NSString *)deviceIPAdress</span><br><span class="line">&#123;</span><br><span class="line">        while (temp_addr != NULL) &#123;</span><br><span class="line">            NSLog(@"ifa_name===%@",[NSString stringWithUTF8String:temp_addr-&gt;ifa_name]);</span><br><span class="line">            // Check if interface is en0 which is the wifi connection on the iPhone</span><br><span class="line">            if ([[NSString stringWithUTF8String:temp_addr-&gt;ifa_name] isEqualToString:@"en0"] || [[NSString stringWithUTF8String:temp_addr-&gt;ifa_name] isEqualToString:@"pdp_ip0"])</span><br><span class="line">            &#123;</span><br><span class="line">                //å¦‚æœæ˜¯IPV4åœ°å€ï¼Œç›´æ¥è½¬åŒ–</span><br><span class="line">                if (temp_addr-&gt;ifa_addr-&gt;sa_family == AF_INET)&#123;</span><br><span class="line">                    // Get NSString from C String</span><br><span class="line">                   address = [self formatIPV4Address:((struct sockaddr_in *)temp_addr-&gt;ifa_addr)-&gt;sin_addr];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                //å¦‚æœæ˜¯IPV6åœ°å€</span><br><span class="line">                else if (temp_addr-&gt;ifa_addr-&gt;sa_family == AF_INET6)&#123;</span><br><span class="line">                    address = [self formatIPV6Address:((struct sockaddr_in6 *)temp_addr-&gt;ifa_addr)-&gt;sin6_addr];</span><br><span class="line">                    if (address &amp;&amp; ![address isEqualToString:@""] &amp;&amp; ![address.uppercaseString hasPrefix:@"FE80"]) break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            temp_addr = temp_addr-&gt;ifa_next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-è®¾å¤‡ç½‘å…³åœ°å€è·å–è·å–æ”¯æŒIPV6"><a href="#4-3-è®¾å¤‡ç½‘å…³åœ°å€è·å–è·å–æ”¯æŒIPV6" class="headerlink" title="4.3 è®¾å¤‡ç½‘å…³åœ°å€è·å–è·å–æ”¯æŒIPV6"></a>4.3 è®¾å¤‡ç½‘å…³åœ°å€è·å–è·å–æ”¯æŒIPV6</h4><p>å…¶å®æ˜¯åœ¨IPV4è·å–ç½‘å…³åœ°å€çš„æºç çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¿®æ”¹ï¼Œåˆå¼€æŠŠAF_INETï¼&gt;AF_INET6, sockaddr -&gt; sockaddr_in6ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„å¦‚ä¸‹ä¿®æ”¹ï¼Œå°±æ˜¯æ‹·è´çš„åœ°å€å­—èŠ‚æ•°ã€‚å»æ‰äº†ROUNDUPçš„å¤„ç†ã€‚ ï¼ˆè§£æå‡ºæ¥çš„åœ°å€è€æ˜¯å°‘äº†4ä¸ªå­—èŠ‚ï¼Œç»“æœæ˜¯åç§»é‡æé”™äº†ï¼Œçº ç»“äº†åŠå¤©ï¼‰ï¼Œå…·ä½“å‚è€ƒæºç åº“ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">   /* net.route.0.inet.flags.gateway */</span><br><span class="line">    int mib[] = &#123;CTL_NET, PF_ROUTE, 0, AF_INET6, NET_RT_FLAGS, RTF_GATEWAY&#125;;</span><br><span class="line"></span><br><span class="line">    if (sysctl(mib, sizeof(mib) / sizeof(int), buf, &amp;l, 0, 0) &lt; 0) &#123;</span><br><span class="line">         address = @"192.168.0.1";</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ....</span><br><span class="line"></span><br><span class="line">    //for IPV4</span><br><span class="line">    for (i = 0; i &lt; RTAX_MAX; i++) &#123;</span><br><span class="line">                if (rt-&gt;rtm_addrs &amp; (1 &lt;&lt; i)) &#123;</span><br><span class="line">                    sa_tab[i] = sa;</span><br><span class="line">                    sa = (struct sockaddr *)((char *)sa + ROUNDUP(sa-&gt;sa_len));</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    sa_tab[i] = NULL;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">  //for IPV6</span><br><span class="line">     for (i = 0; i &lt; RTAX_MAX; i++) &#123;</span><br><span class="line">                if (rt-&gt;rtm_addrs &amp; (1 &lt;&lt; i)) &#123;</span><br><span class="line">                    sa_tab[i] = sa;</span><br><span class="line">                    sa = (struct sockaddr_in6 *)((char *)sa + sa-&gt;sin6_len);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    sa_tab[i] = NULL;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">4.4 è®¾å¤‡DNSåœ°å€è·å–æ”¯æŒIPV6</span><br><span class="line">IPV4æ—¶åªéœ€è¦é€šè¿‡res_ninitè¿›è¡Œåˆå§‹åŒ–å°±å¯ä»¥è·å–ï¼Œä½†æ˜¯åœ¨IPV6ç¯å¢ƒä¸‹éœ€è¦é€šè¿‡res_getservers()æ¥å£æ‰èƒ½è·å–ã€‚</span><br><span class="line"></span><br><span class="line">+(NSArray *)outPutDNSServers&#123;</span><br><span class="line">    res_state res = malloc(sizeof(struct __res_state));</span><br><span class="line">    int result = res_ninit(res);</span><br><span class="line"></span><br><span class="line">    NSMutableArray *servers = [[NSMutableArray alloc] init];</span><br><span class="line">    if (result == 0) &#123;</span><br><span class="line">        union res_9_sockaddr_union *addr_union = malloc(res-&gt;nscount * sizeof(union res_9_sockaddr_union));</span><br><span class="line">        res_getservers(res, addr_union, res-&gt;nscount);</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; res-&gt;nscount; i++) &#123;</span><br><span class="line">            if (addr_union[i].sin.sin_family == AF_INET) &#123;</span><br><span class="line">                char ip[INET_ADDRSTRLEN];</span><br><span class="line">                inet_ntop(AF_INET, &amp;(addr_union[i].sin.sin_addr), ip, INET_ADDRSTRLEN);</span><br><span class="line">                NSString *dnsIP = [NSString stringWithUTF8String:ip];</span><br><span class="line">                [servers addObject:dnsIP];</span><br><span class="line">                NSLog(@"IPv4 DNS IP: %@", dnsIP);</span><br><span class="line">            &#125; else if (addr_union[i].sin6.sin6_family == AF_INET6) &#123;</span><br><span class="line">                char ip[INET6_ADDRSTRLEN];</span><br><span class="line">                inet_ntop(AF_INET6, &amp;(addr_union[i].sin6.sin6_addr), ip, INET6_ADDRSTRLEN);</span><br><span class="line">                NSString *dnsIP = [NSString stringWithUTF8String:ip];</span><br><span class="line">                [servers addObject:dnsIP];</span><br><span class="line">                NSLog(@"IPv6 DNS IP: %@", dnsIP);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                NSLog(@"Undefined family.");</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res_nclose(res);</span><br><span class="line">    free(res);</span><br><span class="line"></span><br><span class="line">    return [NSArray arrayWithArray:servers];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-4-åŸŸåDNSåœ°å€è·å–æ”¯æŒIPV6"><a href="#4-4-åŸŸåDNSåœ°å€è·å–æ”¯æŒIPV6" class="headerlink" title="4.4 åŸŸåDNSåœ°å€è·å–æ”¯æŒIPV6"></a>4.4 åŸŸåDNSåœ°å€è·å–æ”¯æŒIPV6</h4><p>åœ¨IPV4ç½‘ç»œä¸‹æˆ‘ä»¬é€šè¿‡gethostnameè·å–ï¼Œè€Œåœ¨IPV6ç¯å¢ƒä¸‹ï¼Œé€šè¿‡æ–°çš„gethostbyname2å‡½æ•°è·å–ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//ipv4</span><br><span class="line">phot = gethostbyname(hostN);</span><br><span class="line"></span><br><span class="line">//ipv6</span><br><span class="line"> phot = gethostbyname2(hostN, AF_INET6);</span><br></pre></td></tr></table></figure>
<h4 id="4-5-pingæ–¹æ¡ˆæ”¯æŒIPV6"><a href="#4-5-pingæ–¹æ¡ˆæ”¯æŒIPV6" class="headerlink" title="4.5 pingæ–¹æ¡ˆæ”¯æŒIPV6"></a>4.5 pingæ–¹æ¡ˆæ”¯æŒIPV6</h4><p>Appleçš„å®˜æ–¹æä¾›äº†æœ€æ–°çš„æ”¯æŒIPV6çš„pingæ–¹æ¡ˆï¼Œå‚è€ƒåœ°å€å¦‚ä¸‹ï¼š<br><a href="https://developer.apple.com/library/mac/samplecode/SimplePing/Introduction/Intro.html" target="_blank" rel="external">https://developer.apple.com/library/mac/samplecode/SimplePing/Introduction/Intro.html</a></p>
<p>åªæ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br>ï¼ˆ1ï¼‰è¿”å›çš„packetå»æ‰äº†IPHeaderéƒ¨åˆ†ï¼ŒIPV6çš„headeréƒ¨åˆ†ä¹Ÿä¸è¿”å›TTLï¼ˆTime to Liveï¼‰å­—æ®µï¼›<br>ï¼ˆ2ï¼‰IPV6çš„ICMPæŠ¥æ–‡ä¸è¿›è¡ŒcheckSumçš„å¤„ç†ï¼›</p>
<h4 id="4-6-traceRouteæ–¹æ¡ˆæ”¯æŒIPV6"><a href="#4-6-traceRouteæ–¹æ¡ˆæ”¯æŒIPV6" class="headerlink" title="4.6 traceRouteæ–¹æ¡ˆæ”¯æŒIPV6"></a>4.6 traceRouteæ–¹æ¡ˆæ”¯æŒIPV6</h4><p>å…¶å®æ˜¯é€šè¿‡åˆ›å»ºsocketå¥—æ¥å­—æ¨¡æ‹ŸICMPæŠ¥æ–‡çš„å‘é€ï¼Œä»¥è®¡ç®—è€—æ—¶ï¼›<br>ä¸¤ä¸ªå…³é”®çš„åœ°æ–¹éœ€è¦æ³¨æ„ï¼š<br>ï¼ˆ1ï¼‰IPV6ä¸­å»æ‰IP_TTLå­—æ®µï¼Œæ”¹ç”¨è·³æ•°IPV6_UNICAST_HOPSæ¥è¡¨ç¤ºï¼›<br>ï¼ˆ2ï¼‰sendtoæ–¹æ³•å¯ä»¥å…¼å®¹æ”¯æŒIPV4å’ŒIPV6ï¼Œä½†æ˜¯éœ€è¦æœ€åä¸€ä¸ªå‚æ•°ï¼Œåˆ¶å®šç›®æ ‡IPåœ°å€çš„å¤§å°ï¼›å› ä¸ºå‰ä¸€ä¸ªå‚æ•°åªæ˜¯æŒ‡æ˜äº†IPåœ°å€çš„å¼€å§‹åœ°å€ã€‚åƒä¸‡ä¸è¦ç”¨ç»Ÿä¸€çš„sizeof(struct sockaddr), å› ä¸ºsockaddr_in å’Œ sockaddréƒ½æ˜¯16ä¸ªå­—èŠ‚ï¼Œä¸¤è€…å¯ä»¥é€šç”¨ï¼Œä½†æ˜¯sockaddr_in6çš„æ•°æ®ç»“æ„æ˜¯28ä¸ªå­—èŠ‚ï¼Œå¦‚æœä¸æ˜¾å¼æŒ‡å®šï¼Œsendtoæ–¹æ³•å°±ä¼šä¸€ç›´è¿”å›ï¼1ï¼ŒerroNoæŠ¥22 Invalid argumentçš„é”™è¯¯ã€‚</p>
<p>å…³é”®ä»£ç å¦‚ä¸‹ï¼šï¼ˆå®Œæ•´ä»£ç å‚è€ƒå¼€æºç»„ä»¶ï¼‰</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">//æ„é€ é€šç”¨çš„IPåœ°å€ç»“æ„stuck sockaddr</span><br><span class="line"></span><br><span class="line"> NSString *ipAddr0 = [serverDNSs objectAtIndex:0];</span><br><span class="line">    //è®¾ç½®serverä¸»æœºçš„å¥—æ¥å£åœ°å€</span><br><span class="line">    NSData *addrData = nil;</span><br><span class="line">    BOOL isIPV6 = NO;</span><br><span class="line">    if ([ipAddr0 rangeOfString:@":"].location == NSNotFound) &#123;</span><br><span class="line">        isIPV6 = NO;</span><br><span class="line">        struct sockaddr_in nativeAddr4;</span><br><span class="line">        memset(&amp;nativeAddr4, 0, sizeof(nativeAddr4));</span><br><span class="line">        nativeAddr4.sin_len = sizeof(nativeAddr4);</span><br><span class="line">        nativeAddr4.sin_family = AF_INET;</span><br><span class="line">        nativeAddr4.sin_port = htons(udpPort);</span><br><span class="line">        inet_pton(AF_INET, ipAddr0.UTF8String, &amp;nativeAddr4.sin_addr.s_addr);</span><br><span class="line">        addrData = [NSData dataWithBytes:&amp;nativeAddr4 length:sizeof(nativeAddr4)];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        isIPV6 = YES;</span><br><span class="line">        struct sockaddr_in6 nativeAddr6;</span><br><span class="line">        memset(&amp;nativeAddr6, 0, sizeof(nativeAddr6));</span><br><span class="line">        nativeAddr6.sin6_len = sizeof(nativeAddr6);</span><br><span class="line">        nativeAddr6.sin6_family = AF_INET6;</span><br><span class="line">        nativeAddr6.sin6_port = htons(udpPort);</span><br><span class="line">        inet_pton(AF_INET6, ipAddr0.UTF8String, &amp;nativeAddr6.sin6_addr);</span><br><span class="line">        addrData = [NSData dataWithBytes:&amp;nativeAddr6 length:sizeof(nativeAddr6)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    struct sockaddr *destination;</span><br><span class="line">    destination = (struct sockaddr *)[addrData bytes];</span><br><span class="line"></span><br><span class="line">//åˆ›å»ºsocket</span><br><span class="line">if ((recv_sock = socket(destination-&gt;sa_family, SOCK_DGRAM, isIPV6?IPPROTO_ICMPV6:IPPROTO_ICMP)) &lt; 0)</span><br><span class="line">if ((send_sock = socket(destination-&gt;sa_family, SOCK_DGRAM, 0)) &lt; 0)</span><br><span class="line"></span><br><span class="line">//è®¾ç½®sender å¥—æ¥å­—çš„ttl</span><br><span class="line">if ((isIPV6? </span><br><span class="line">setsockopt(send_sock,IPPROTO_IPV6, IPV6_UNICAST_HOPS, &amp;ttl, sizeof(ttl)):</span><br><span class="line">setsockopt(send_sock, IPPROTO_IP, IP_TTL, &amp;ttl, sizeof(ttl))) &lt; 0)</span><br><span class="line"></span><br><span class="line">//å‘é€æˆåŠŸè¿”å›å€¼ç­‰äºå‘é€æ¶ˆæ¯çš„é•¿åº¦</span><br><span class="line">ssize_t sentLen = sendto(send_sock, cmsg, sizeof(cmsg), 0, </span><br><span class="line">(struct sockaddr *)destination, </span><br><span class="line">isIPV6?sizeof(struct sockaddr_in6):sizeof(struct sockaddr_in));</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>


    <div>
      
    </div>

<! -- æ·»åŠ å¾®ä¿¡å›¾æ ‡ -->
    
    
    
    

    <footer class="post-footer">

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/24/äº§å“è®¾è®¡å¸ˆå¸¸ç”¨ç½‘ç«™/" itemprop="url">
                  äº§å“è®¾è®¡å¸ˆå¸¸ç”¨ç½‘ç«™
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="fa fa-calendar-o" style="margin:2px"></span>
            <time itemprop="dateCreated" datetime="2016-05-24T10:35:46+08:00" content="2016-05-24">
              2016-05-24
            </time>
          </span>
	
	<span class="post-count">&nbsp; |&nbsp; å­—æ•° 1,458
	</span>

	<span class="post-count">&nbsp; |&nbsp; é˜…è¯»é¢„è®¡ 7åˆ†é’Ÿ</span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="fa fa-folder-o" style="margin:2px"></span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/design/" itemprop="url" rel="index">
                    <span itemprop="name">design</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/24/äº§å“è®¾è®¡å¸ˆå¸¸ç”¨ç½‘ç«™/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/24/äº§å“è®¾è®¡å¸ˆå¸¸ç”¨ç½‘ç«™/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/05/24/äº§å“è®¾è®¡å¸ˆå¸¸ç”¨ç½‘ç«™/" class="leancloud_visitors" data-flag-title="äº§å“è®¾è®¡å¸ˆå¸¸ç”¨ç½‘ç«™">
               &nbsp; | &nbsp;
               <span class="fa fa-eye" style="margin:2px"></span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><img src="http://7xstl7.com1.z0.glb.clouddn.com/%E8%AE%BE%E8%AE%A1/s.jpg" alt=""></p>
<blockquote>
<p>æˆé•¿æ˜¯ä»ç§¯ç´¯åˆ°æ¶Œç°çš„è¿‡ç¨‹ã€‚å¥½çš„äº§å“è®¾è®¡å¸ˆé¦–å…ˆè¦æœ‰å¥½çš„ç´ æç§¯ç´¯ï¼Œæ‰èƒ½æ¶Œç°å‡ºåŠ¨äººçš„ä½œå“ã€‚ä¸‹é¢æ˜¯æˆ‘æ•´ç†å‡ºæ¥çš„å¸¸ç”¨çš„ç½‘ç«™ã€‚å¸Œæœ›ç»™å¤§å®¶å¸¦æ¥å¸®åŠ©ã€‚ï¼ˆæ‰“ä¸å¼€è¯·æŒ‚VPNï¼‰</p>
</blockquote>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/05/24/äº§å“è®¾è®¡å¸ˆå¸¸ç”¨ç½‘ç«™/#more" rel="contents">
              é˜…è¯»å…¨æ–‡ &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>


    <div>
      
    </div>

<! -- æ·»åŠ å¾®ä¿¡å›¾æ ‡ -->
    
    
    
    

    <footer class="post-footer">

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/20/iOS-æ•™ä½ å¦‚ä½•ä¿®æ”¹å¾®ä¿¡è¿åŠ¨æ­¥æ•°/" itemprop="url">
                  iOS æ•™ä½ å¦‚ä½•ä¿®æ”¹å¾®ä¿¡è¿åŠ¨æ­¥æ•°
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="fa fa-calendar-o" style="margin:2px"></span>
            <time itemprop="dateCreated" datetime="2016-05-20T17:57:04+08:00" content="2016-05-20">
              2016-05-20
            </time>
          </span>
	
	<span class="post-count">&nbsp; |&nbsp; å­—æ•° 1,090
	</span>

	<span class="post-count">&nbsp; |&nbsp; é˜…è¯»é¢„è®¡ 4åˆ†é’Ÿ</span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="fa fa-folder-o" style="margin:2px"></span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/é€†å‘å·¥ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">é€†å‘å·¥ç¨‹</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/20/iOS-æ•™ä½ å¦‚ä½•ä¿®æ”¹å¾®ä¿¡è¿åŠ¨æ­¥æ•°/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/20/iOS-æ•™ä½ å¦‚ä½•ä¿®æ”¹å¾®ä¿¡è¿åŠ¨æ­¥æ•°/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/05/20/iOS-æ•™ä½ å¦‚ä½•ä¿®æ”¹å¾®ä¿¡è¿åŠ¨æ­¥æ•°/" class="leancloud_visitors" data-flag-title="iOS æ•™ä½ å¦‚ä½•ä¿®æ”¹å¾®ä¿¡è¿åŠ¨æ­¥æ•°">
               &nbsp; | &nbsp;
               <span class="fa fa-eye" style="margin:2px"></span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>è¯´æ˜: ç›¸ä¿¡å–œæ¬¢é€†å‘å·¥ç¨‹çš„å°ä¼™ä¼´å·²ç»å¯¹å¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…æ’ä»¶æœ‰æ‰€è€³é—»äº†,æˆ–è€…å¯ä»¥è¯´,å·²ç»è¢«å¹¿æ³›çš„ä¼ æ’­äº†,ä½†ç¬”è€…å‘ç°,å…¶å®åªæœ‰ä¸¤ç¯‡æ˜¯åŸåˆ›çš„,å…¶ä½™å‡ä¸ºç–¯ç‹‚è½¬è½½.çœ‹äº†ä¸‹ç½‘ä¸Šå¯¹äºå¾®ä¿¡çš„â€å–œçˆ±â€ç›®å‰åªæœ‰æŠ¢çº¢åŒ…è¿™å—,æ‰€ä»¥ä¸ºå¤§å®¶å¸¦æ¥å¦ä¸€ä¸ªå®ç”¨æ€§æŠ€èƒ½â€”ä¿®æ”¹å¾®ä¿¡è¿åŠ¨å‚æ•°,å¦ˆå¦ˆåœ¨ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘æŠŠæ‰‹æœºç»‘åœ¨ç‹—è…¿ä¸Šäº†ğŸ˜„!</p>
</blockquote>
<p><img src="http://7xstl7.com1.z0.glb.clouddn.com/%E6%8A%80%E6%9C%AF/nixiang_title.png" alt=""></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/05/20/iOS-æ•™ä½ å¦‚ä½•ä¿®æ”¹å¾®ä¿¡è¿åŠ¨æ­¥æ•°/#more" rel="contents">
              é˜…è¯»å…¨æ–‡ &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>


    <div>
      
    </div>

<! -- æ·»åŠ å¾®ä¿¡å›¾æ ‡ -->
    
    
    
    

    <footer class="post-footer">

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/17/iOS-çŸ¥è¯†-å¸¸ç”¨å°æŠ€å·§å¤§æ‚çƒ©/" itemprop="url">
                  iOS çŸ¥è¯†-å¸¸ç”¨å°æŠ€å·§å¤§æ‚çƒ©
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="fa fa-calendar-o" style="margin:2px"></span>
            <time itemprop="dateCreated" datetime="2016-05-17T10:53:09+08:00" content="2016-05-17">
              2016-05-17
            </time>
          </span>
	
	<span class="post-count">&nbsp; |&nbsp; å­—æ•° 14,581
	</span>

	<span class="post-count">&nbsp; |&nbsp; é˜…è¯»é¢„è®¡ 83åˆ†é’Ÿ</span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="fa fa-folder-o" style="margin:2px"></span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOSæŠ€æœ¯å½’çº³/" itemprop="url" rel="index">
                    <span itemprop="name">iOSæŠ€æœ¯å½’çº³</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/17/iOS-çŸ¥è¯†-å¸¸ç”¨å°æŠ€å·§å¤§æ‚çƒ©/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/17/iOS-çŸ¥è¯†-å¸¸ç”¨å°æŠ€å·§å¤§æ‚çƒ©/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/05/17/iOS-çŸ¥è¯†-å¸¸ç”¨å°æŠ€å·§å¤§æ‚çƒ©/" class="leancloud_visitors" data-flag-title="iOS çŸ¥è¯†-å¸¸ç”¨å°æŠ€å·§å¤§æ‚çƒ©">
               &nbsp; | &nbsp;
               <span class="fa fa-eye" style="margin:2px"></span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜</p>
<p>ç½‘ä¸ŠæŸ¥é˜…æ•´ç†çš„ä¸€äº›é—®é¢˜</p>
<p>ä¾›å¤§å®¶å‚è€ƒï¼Œæ–¹ä¾¿å¤§å®¶æŸ¥é˜…</p>
</blockquote>
<p><img src="http://7xstl7.com1.z0.glb.clouddn.com/%E6%8A%80%E6%9C%AF/techo.jpg" alt=""><br>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/05/17/iOS-çŸ¥è¯†-å¸¸ç”¨å°æŠ€å·§å¤§æ‚çƒ©/#more" rel="contents">
              é˜…è¯»å…¨æ–‡ &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>


    <div>
      
    </div>

<! -- æ·»åŠ å¾®ä¿¡å›¾æ ‡ -->
    
    
    
    

    <footer class="post-footer">

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/10/iOS-Hybrid-æ¡†æ¶-â€”â€”PhoneGap/" itemprop="url">
                  iOS Hybrid æ¡†æ¶ â€”â€”PhoneGap
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="fa fa-calendar-o" style="margin:2px"></span>
            <time itemprop="dateCreated" datetime="2016-05-10T17:13:09+08:00" content="2016-05-10">
              2016-05-10
            </time>
          </span>
	
	<span class="post-count">&nbsp; |&nbsp; å­—æ•° 4,599
	</span>

	<span class="post-count">&nbsp; |&nbsp; é˜…è¯»é¢„è®¡ 26åˆ†é’Ÿ</span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="fa fa-folder-o" style="margin:2px"></span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hybrid/" itemprop="url" rel="index">
                    <span itemprop="name">Hybrid</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/10/iOS-Hybrid-æ¡†æ¶-â€”â€”PhoneGap/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/10/iOS-Hybrid-æ¡†æ¶-â€”â€”PhoneGap/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/05/10/iOS-Hybrid-æ¡†æ¶-â€”â€”PhoneGap/" class="leancloud_visitors" data-flag-title="iOS Hybrid æ¡†æ¶ â€”â€”PhoneGap">
               &nbsp; | &nbsp;
               <span class="fa fa-eye" style="margin:2px"></span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><blockquote>
<p>Hybrid Appï¼ˆæ··åˆæ¨¡å¼ç§»åŠ¨åº”ç”¨ï¼‰æ˜¯æŒ‡ä»‹äºweb-appã€native-appè¿™ä¸¤è€…ä¹‹é—´çš„appï¼Œå…¼å…·â€œNative Appè‰¯å¥½ç”¨æˆ·äº¤äº’ä½“éªŒçš„ä¼˜åŠ¿â€å’Œâ€œWeb Appè·¨å¹³å°å¼€å‘çš„ä¼˜åŠ¿â€ã€‚</p>
</blockquote>
<p><img src="http://7xstl7.com1.z0.glb.clouddn.com/Hybrid/hybrid_4.jpg" alt=""><br>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/05/10/iOS-Hybrid-æ¡†æ¶-â€”â€”PhoneGap/#more" rel="contents">
              é˜…è¯»å…¨æ–‡ &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>


    <div>
      
    </div>

<! -- æ·»åŠ å¾®ä¿¡å›¾æ ‡ -->
    
    
    
    

    <footer class="post-footer">

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://i4.piimg.com/5daa87b3f5ce23a2.jpg"
               alt="æä¸–è¶…" />
          <p class="site-author-name" itemprop="name">æä¸–è¶…</p>
          <p class="site-description motion-element" itemprop="description">å—¨ï¼Œæˆ‘æ˜¯æä¸–è¶… (@Amin_iOS)ï¼Œä¸€åç§»åŠ¨ç«¯çš„Development And Managementï¼Œç°å±…å¹¿å·ã€‚æ­£åœ¨ä¿®è¡Œï¼Œæ¢æ±‚åˆ›æ„ä¹‹æºï¼Œè®°å½•è‡ªå·±å­¦ä¹ çš„ç‚¹æ»´ã€‚</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/lishichao706" target="_blank">
                  
                    <i class="fa fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/ab8e592732ea/latest_articles" target="_blank">
                  
                    <i class="fa fa-pinterest"></i>
                  
                  ç®€ä¹¦
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/lishichao" target="_blank">
                  
                    <i class="fa fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/Amin_706" target="_blank">
                  
                    <i class="fa fa-twitter"></i>
                  
                  twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
            <div class="links-of-blogroll-title">æˆ‘çš„é“¾æ¥</div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://i2.piimg.com/c3957b482e32ec3f.jpg" target="_blank">å¾®ä¿¡å…¬ä¼—å·</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.cocoachina.com/304267" target="_blank">CocoaChina</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/lishichao706" target="_blank">CSDN</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.zhihu.com/people/amin706" target="_blank">çŸ¥ä¹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://zhuanlan.zhihu.com/lishichao" target="_blank">çŸ¥ä¹ä¸“æ </a>
                </li>
              
            </ul>
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2010 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æä¸–è¶…</span>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<span id="busuanzi_container_site_pv">
    æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
</span>

<span id="busuanzi_container_site_uv">
  æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡
</span>




      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lishichao706"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("JDa3L42Y5MiAqtYFX35OrssM-gzGzoHsz", "lOQmfvDtuB60v4dhjjy7wbKv");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
